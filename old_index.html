<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>FETTENAJS X-ray viewer</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css2?family=Exo+2" rel="stylesheet" />
  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/magnific-popup.css">

  <!-- Custom xray css-->
  <link rel="stylesheet" href="css/xray.css" />

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <!-- <link rel="icon" type="image/png" href="images/favicon.png"> -->

  <!-- JS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="js/magnific-popup.js"></script>

  <!-- Custom xray JS -->
  <script>/*for templating*/</script>
  <script src="js/xray.js"></script>
  <script>
    $(document).ready(function() {
        //https://stackoverflow.com/questions/5999118/how-can-i-add-or-update-a-query-string-parameter
        const getUriWithParam = (baseUrl, params) => {
            const Url = new URL(baseUrl);
            const urlParams = new URLSearchParams(Url.search);
            for (const key in params) {
                if (params[key] !== undefined) {
                urlParams.set(key, params[key]);
                }
            }
            Url.search = urlParams.toString();
            return Url.toString();
        };

		const params = new URL(location.href).searchParams;
		const diagnosis = params.get('diagnosis');

        const localurl = window.location.href;
        console.log(localurl);
        
        if(diagnosis == "on") {
            coursesuffix = "&diagnosis=on";
            dgsuffix = "";
            var dgswitchhref = getUriWithParam(localurl, {diagnosis: "off"});
            //console.log("test log to off: " + test);
        } else {
            coursesuffix = "&diagnosis=off";
            var dgswitchhref = getUriWithParam(localurl, {diagnosis: "on"});
            //console.log("test log to on: " + test);

        }

        var orthohref = "ortho" + coursesuffix;
        var pulmohref = "pulmo" + coursesuffix;
        var pedsurghref = "pedsurg" + coursesuffix;

        var ortholink = document.getElementById('ortholink');
        ortholink.href = orthohref;

        var pulmolink = document.getElementById('pulmolink');
        pulmolink.href = pulmohref;

        var pedsurglink = document.getElementById('pedsurglink');
        pedsurglink.href = pedsurghref;

        var dglinkid = document.getElementById('dglinkswitch');
        dglinkid.href = dgswitchhref;


    })
  </script>

</head>
<body>
<div class="container" style="margin-top: 0px;">
    <div class="row">
        <div class="two columns"></div>
        <div class="ten columns" id="scrolldiv"  style="margin: 0 auto; width: 50%;">
            <nav>
                <h4 style="font-family: 'Exo 2';">fettenajs xray viewer</h4>
                <p style="font-weight: bold;">Please be advised: It may take some time to load this page (65.5 MB).<br>
                PRO TIP #1: Click on the images for zoom and gallery function.<br>
                PRO TIP #2: Click on the case #number to show the diagnosis</p>
            </p>
                <ul id="nav">
                    <!-- <li><a href="#home">Home</a></li> -->
                    <li><a id="ortholink">Orthopaedics</a></li>
                    <li><a id="pulmolink">Pulmonology</a></li>
                    <li><a id="pedsurglink">Pediatric surgery</a></li>
                    <li style="float: right;"><a id="dglinkswitch" style="color: red">Diagnosis ON/OFF</a></li>
                </ul>
            </nav>
        </div>
    </div>
    <div class="row" style="padding-top: 250px;">
        <div class="two columns"></div>
        <div class="ten columns" id="main">
            <table id="tableMain">

            </table>


<!--<?php

$folders = array_diff(scandir($src), array('..', '.'));
sort($folders, SORT_NUMERIC);

echo "<table>";

$key = 1;

foreach($folders as $folder) {
    $scanfile = array_diff(scandir($src.$folder), array('..', '.', 'desc.txt'));
    $fo = fopen($src.$folder."/desc.txt", "r");
        $fr = fread($fo, filesize($src.$folder."/desc.txt"));
        fclose($fo);
    echo "<thead>";
    echo "<tr><th colspan='2'>";

    if(@$_GET["hidden"]==1) {
        $header = "<a href='#' onclick='$(hiddenText".$key.").show(); return false;'>#".$key."</a><span style=\"display: none;\" id=\"hiddenText".$key."\"> - ".$fr."</span>";
        $imgTitle = "CASE #".$folder;
    } else {
        $header = "#".$folder." - ".$fr;
        $imgTitle = "CASE #".$folder." - ".$fr;
    }

    echo "<h5 id='".$key."'>".$header."</h5>";
    echo "</th></tr>";
    echo "</thead>";

    echo "<tbody class='popup-gallery'>";
    echo "<tr>";

    $x = count($scanfile);
    $y = $x;

    foreach($scanfile as $file) {

        $countXrays = count($scanfile);

        // File and new size
        $filename = $src.$folder."/".$file;

        echo "<td>";
  
        echo "<a href='".$filename."' title='".$imgTitle."'><img src='".$src.$folder."/".$file."' style='width: 100%; height: auto;'></a>";
        $y = $y - 1;
        if($y % 2 == 0) {
            echo "</td></tr>";
            if($y != 0) echo "<tr>";
        } else {
            echo "</td>";
        }

    }

    echo "</tbody>";
    $key++;

}

echo "</table>";

?>-->

</div>
</div>
</div>
</body>
</html>